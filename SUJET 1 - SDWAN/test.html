<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SD-WAN Intelligence - Gestion de Parc & Cycle de Vie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Configuration de base et Typographie */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Slate-100 */
            color: #1f2937;
            /* Gray-800 */
        }

        /* Chart Container Requirements - Strict Compliance */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            /* Adaptatif */
            height: 300px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 1024px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar for tables */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Navigation Active State */
        .nav-item.active {
            background-color: #f97316;
            /* Orange-500 (Brand reference) */
            color: white;
        }

        /* Utility for step visualization */
        .step-connector::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 100%;
            width: 2rem;
            height: 2px;
            background-color: #e2e8f0;
            transform: translateY(-50%);
            z-index: 0;
        }

        .step-item:last-child .step-connector::after {
            display: none;
        }
    </style>
    <!-- Chosen Palette: Warm Professional. Backgrounds: Slate-50/100. Text: Slate-800. Primary: Orange-500 (referencing the client context). Secondary: Blue-600. Alerts: Red-500/Amber-500. -->

    <!-- Application Structure Plan:
         1. **Sidebar Navigation**: Persistent access to key modules (Dashboard, Inventory, Lifecycle, Upgrade Scenarios).
         2. **Header**: Contextual information and global search/filter.
         3. **Dashboard (Vue Globale)**: KPI cards and high-level charts to show fleet health immediately.
         4. **Inventory (Parc R√©seau)**: Detailed interactive table with filtering to explore specific device metrics (from "edges measured max values").
         5. **Lifecycle Analysis (Cycle de Vie)**: Visual timeline of EOL/EOS status derived from "SD-WAN edges lifecycle".
         6. **Upgrade Simulator (Sc√©nario AVV)**: The core interactive tool. Allows selecting a target version (e.g., 6.4.0) and generates a report on feasibility, identifying hardware bottlenecks and upgrade paths (Logic from "Software versions overview").
         This structure separates "Monitoring" (Current State) from "Planning" (Future State), critical for the "Reprise de parc" scenario described in the prompt.
    -->

    <!-- Visualization & Content Choices:
         1. **Fleet Status (Doughnut)**: Goal: Inform. Shows distribution of models/versions. Justification: Quick visual breakdown of heterogeneity.
         2. **Lifecycle Timeline (Bar)**: Goal: Change/Planning. Visualizes time remaining for support. Justification: Easier to grasp urgency than a date list.
         3. **Throughput Capacity (Scatter)**: Goal: Compare. Plots 'Measured Throughput' vs 'Max Capacity'. Justification: Instantly identifies devices needing hardware replacement (Prompt: "notions de co√ªts/solutions adapt√©es").
         4. **Upgrade Path (Step Flow)**: Goal: Process. HTML/CSS visualization of version hops (4.x -> 5.x -> 6.x). Justification: Clarity on the operational complexity.
         5. **Cost/Action Table**: Goal: Decision Support. Summarizes specific actions (Upgrade SW vs Replace HW) with simulated cost units.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. Charts via Chart.js. Icons via Unicode/HTML entities. -->
</head>

<body class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col shadow-sm z-10 hidden md:flex">
        <div class="p-6 border-b border-gray-100">
            <h1 class="text-xl font-bold text-gray-800 tracking-tight">SD-WAN <span class="text-orange-500">Pilot</span>
            </h1>
            <p class="text-xs text-gray-500 mt-1">Outil d'aide √† la d√©cision</p>
        </div>

        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="switchView('dashboard')" id="nav-dashboard"
                class="nav-item active w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-orange-50 hover:text-orange-600">
                <span>üìä</span> Vue d'ensemble
            </button>
            <button onclick="switchView('inventory')" id="nav-inventory"
                class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-orange-50 hover:text-orange-600">
                <span>üñ•Ô∏è</span> Parc & Performance
            </button>
            <button onclick="switchView('lifecycle')" id="nav-lifecycle"
                class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-orange-50 hover:text-orange-600">
                <span>‚è≥</span> Cycle de Vie (EOL)
            </button>
            <button onclick="switchView('upgrade')" id="nav-upgrade"
                class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-orange-50 hover:text-orange-600">
                <span>üöÄ</span> Sc√©narios & Mises √† jour
            </button>
        </nav>

        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <div class="text-xs text-gray-500 mb-2">Statut du Syst√®me</div>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span class="text-sm font-medium text-gray-700">Connect√© (Mode D√©mo)</span>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 w-full bg-white z-20 border-b p-4 flex justify-between items-center">
        <h1 class="font-bold text-gray-800">SD-WAN Pilot</h1>
        <button onclick="toggleMobileMenu()" class="text-gray-600 focus:outline-none">‚ò∞</button>
    </div>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto bg-slate-50 relative p-6 mt-12 md:mt-0 custom-scroll">

        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="space-y-6 animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Tableau de Bord</h2>
                <p class="text-gray-500 mt-1">Synth√®se de l'√©tat du parc r√©seau, versions logicielles et alertes de
                    cycle de vie.</p>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mt-4 rounded-r-md">
                    <p class="text-sm text-blue-700">
                        <strong>Contexte :</strong> Ce tableau de bord agr√®ge les donn√©es issues des audits techniques
                        (fichier <em>Hackathon Sujet 1 SDWAN.pdf</em>) et les compare aux politiques de cycle de vie
                        (<em>SD-WAN edges lifecycle</em>). Il permet d'identifier rapidement les zones de risque
                        (√©quipements obsol√®tes ou surcharg√©s).
                    </p>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-semibold text-gray-400 uppercase">Total √âquipements</p>
                            <h3 class="text-3xl font-bold text-gray-800 mt-1" id="kpi-total">--</h3>
                        </div>
                        <span class="p-2 bg-blue-100 text-blue-600 rounded-lg text-xl">üåê</span>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">Parc actif d√©tect√©</div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-semibold text-gray-400 uppercase">Mod√®les Legacy (EOL)</p>
                            <h3 class="text-3xl font-bold text-red-600 mt-1" id="kpi-eol">--</h3>
                        </div>
                        <span class="p-2 bg-red-100 text-red-600 rounded-lg text-xl">‚ö†Ô∏è</span>
                    </div>
                    <div class="mt-4 text-sm text-red-500 font-medium">Action requise sous 6 mois</div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-semibold text-gray-400 uppercase">Version Moyenne</p>
                            <h3 class="text-3xl font-bold text-gray-800 mt-1" id="kpi-avg-ver">4.x</h3>
                        </div>
                        <span class="p-2 bg-orange-100 text-orange-600 rounded-lg text-xl">üíæ</span>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">Cible recommand√©e : 6.4.0</div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-semibold text-gray-400 uppercase">Surcharge Critique</p>
                            <h3 class="text-3xl font-bold text-amber-600 mt-1" id="kpi-overload">--</h3>
                        </div>
                        <span class="p-2 bg-amber-100 text-amber-600 rounded-lg text-xl">üî•</span>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">> 90% capacit√© max mesur√©e</div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Fleet Distribution -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">R√©partition par Mod√®le</h3>
                    <div class="chart-container">
                        <canvas id="chart-models"></canvas>
                    </div>
                </div>

                <!-- Software Versions -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Fragmentation des Versions Logicielles</h3>
                    <div class="chart-container">
                        <canvas id="chart-versions"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- INVENTORY VIEW -->
        <section id="view-inventory" class="space-y-6 hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Analyse de Performance & Inventaire</h2>
                <p class="text-gray-500 mt-1">D√©tail des √©quipements, m√©triques mesur√©es vs th√©oriques.</p>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 mt-4 text-sm">
                    <p>Cette section permet d'analyser les donn√©es techniques brutes (d√©bit, flux, tunnels) pour chaque
                        Edge. Les donn√©es rouges indiquent un d√©passement des seuils de capacit√© hardware (Source:
                        <em>edges measured max values.pdf</em>).
                    </p>
                </div>
            </div>

            <!-- Filters -->
            <div class="flex flex-wrap gap-4 bg-white p-4 rounded-lg shadow-sm">
                <input type="text" id="search-inventory" placeholder="Rechercher (Host, Mod√®le)..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none">
                <select id="filter-model"
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none bg-white">
                    <option value="all">Tous les mod√®les</option>
                    <!-- Populated by JS -->
                </select>
                <select id="filter-status"
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none bg-white">
                    <option value="all">Tous statuts</option>
                    <option value="critical">Critique (Surcharge)</option>
                    <option value="ok">Normal</option>
                </select>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
                                <th class="p-4 border-b">Hostname</th>
                                <th class="p-4 border-b">Mod√®le</th>
                                <th class="p-4 border-b">Version Actuelle</th>
                                <th class="p-4 border-b text-right">D√©bit Mesur√© (Mb/s)</th>
                                <th class="p-4 border-b text-right">Flux Simultan√©s</th>
                                <th class="p-4 border-b text-center">Statut Capacit√©</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body" class="text-sm divide-y divide-gray-100">
                            <!-- Rows populated by JS -->
                        </tbody>
                    </table>
                </div>
                <div class="p-4 bg-gray-50 text-xs text-gray-500 text-center" id="inventory-count">
                    Affichage de 0 √©l√©ments
                </div>
            </div>
        </section>

        <!-- LIFECYCLE VIEW -->
        <section id="view-lifecycle" class="space-y-6 hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Cycle de Vie Mat√©riel (EOL/EOS)</h2>
                <p class="text-gray-500 mt-1">Projection des fins de support mat√©riel.</p>
                <div class="bg-amber-50 border-l-4 border-amber-500 p-4 mt-4 rounded-r-md">
                    <p class="text-sm text-amber-800">
                        <strong>Attention :</strong> Les mod√®les 520, 540 et 840 approchent de leur date de fin de
                        support (End of Support). Un plan de remplacement mat√©riel est n√©cessaire avant d'envisager une
                        migration vers les versions logicielles 6.x.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Timeline Chart -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Chronologie de Fin de Support</h3>
                    <div class="chart-container">
                        <canvas id="chart-lifecycle"></canvas>
                    </div>
                </div>

                <!-- Summary List -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Mod√®les √† Risque</h3>
                    <div class="space-y-4" id="lifecycle-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- UPGRADE SCENARIOS VIEW -->
        <section id="view-upgrade" class="space-y-6 hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Simulateur de Mise √† Jour (IA Assist)</h2>
                <p class="text-gray-500 mt-1">G√©n√©ration de sc√©narios de migration bas√©s sur les contraintes mat√©rielles
                    et logicielles.</p>
                <div class="mt-4 p-4 bg-indigo-50 rounded-lg text-sm text-indigo-800">
                    <strong>Objectif :</strong> D√©finir le chemin de version optimal et identifier les co√ªts de mat√©riel
                    associ√©s pour atteindre la conformit√©.
                </div>
            </div>

            <!-- Scenario Controls -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Version Cible Souhait√©e</label>
                        <select id="target-version-select"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white">
                            <option value="5.4.0">5.4.0 (LTS Stable)</option>
                            <option value="6.1.0">6.1.0 (Feature Rich)</option>
                            <option value="6.4.0" selected>6.4.0 (Derni√®re Recommand√©e)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Strat√©gie de Remplacement</label>
                        <select id="replacement-strategy"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white">
                            <option value="conservative">Conservateur (Minimiser les co√ªts)</option>
                            <option value="performance">Performance (Remplacer si >70% charge)</option>
                        </select>
                    </div>
                    <button onclick="runScenario()"
                        class="w-full px-6 py-2 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 transition-colors shadow-sm">
                        G√©n√©rer le Sc√©nario
                    </button>
                </div>
            </div>

            <!-- Results Area (Hidden by default) -->
            <div id="scenario-results" class="hidden space-y-6">

                <!-- AI Insight Box -->
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-6 rounded-xl shadow-md">
                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-white/10 rounded-lg text-2xl">ü§ñ</div>
                        <div>
                            <h3 class="text-lg font-bold mb-2">Analyse Intelligente</h3>
                            <p id="ai-insight-text" class="text-gray-300 text-sm leading-relaxed">
                                <!-- Dynamic Text -->
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Comparison Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-5 rounded-lg border-l-4 border-green-500 shadow-sm">
                        <p class="text-xs text-gray-500 uppercase">√âquipements Compatibles</p>
                        <p class="text-2xl font-bold text-gray-800 mt-1" id="res-compatible">--</p>
                        <p class="text-xs text-green-600 mt-1">Mise √† jour logicielle directe</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-red-500 shadow-sm">
                        <p class="text-xs text-gray-500 uppercase">Remplacements N√©cessaires</p>
                        <p class="text-2xl font-bold text-gray-800 mt-1" id="res-replace">--</p>
                        <p class="text-xs text-red-600 mt-1">Bloquant pour la version cible</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-gray-500 shadow-sm">
                        <p class="text-xs text-gray-500 uppercase">Estimation Co√ªt Mat√©riel</p>
                        <p class="text-2xl font-bold text-gray-800 mt-1" id="res-cost">-- k‚Ç¨</p>
                        <p class="text-xs text-gray-500 mt-1">Bas√© sur mod√®les standards</p>
                    </div>
                </div>

                <!-- Upgrade Path Visual -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-6">Chemin de Mise √† Jour Recommand√©</h3>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4" id="upgrade-steps">
                        <!-- Steps injected by JS -->
                    </div>
                </div>

                <!-- Detailed Action Table -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-4 border-b border-gray-100 font-semibold text-gray-700">Actions Requises par
                        √âquipement</div>
                    <div class="overflow-x-auto max-h-96 custom-scroll">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs text-gray-500 uppercase sticky top-0">
                                <tr>
                                    <th class="p-3">Hostname</th>
                                    <th class="p-3">Mod√®le Actuel</th>
                                    <th class="p-3">Version Actuelle</th>
                                    <th class="p-3">Action</th>
                                    <th class="p-3">Cible (Mat√©riel/Logiciel)</th>
                                </tr>
                            </thead>
                            <tbody id="scenario-table-body" class="text-sm divide-y divide-gray-100">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <script>
        // --- DATA LAYER (Simulated from Documents) ---

        // Mock Data based on "Hackathon Sujet 1 SDWAN.pdf" and "edges measured max values.pdf"
        // We simulate a dataset of ~25 devices to represent the fleet
        const fleetData = [
            { host: "host-edge840-01", model: "Edge 840", version: "4.2.2", throughput: 8, maxTp: 710, flows: 30, maxFlows: 100000, status: "ok" },
            { host: "host-edge840-03", model: "Edge 840", version: "4.2.2", throughput: 67, maxTp: 710, flows: 1200, maxFlows: 100000, status: "ok" },
            { host: "host-edge840-05", model: "Edge 840", version: "4.2.2", throughput: 690, maxTp: 710, flows: 45000, maxFlows: 100000, status: "critical" }, // High Load
            { host: "host-edge840-06", model: "Edge 840", version: "4.5.1", throughput: 80, maxTp: 710, flows: 400, maxFlows: 100000, status: "ok" },
            { host: "host-edge520-10", model: "Edge 520", version: "3.4.0", throughput: 150, maxTp: 200, flows: 2000, maxFlows: 50000, status: "warning" },
            { host: "host-edge520-11", model: "Edge 520", version: "3.4.0", throughput: 190, maxTp: 200, flows: 2500, maxFlows: 50000, status: "critical" },
            { host: "host-edge640-20", model: "Edge 640", version: "5.0.0", throughput: 200, maxTp: 1000, flows: 5000, maxFlows: 200000, status: "ok" },
            { host: "host-edge640-21", model: "Edge 640", version: "5.2.0", throughput: 400, maxTp: 1000, flows: 8000, maxFlows: 200000, status: "ok" },
            { host: "host-edge680-30", model: "Edge 680", version: "6.0.0", throughput: 800, maxTp: 2000, flows: 15000, maxFlows: 400000, status: "ok" },
            { host: "host-edge610-40", model: "Edge 610", version: "4.3.0", throughput: 50, maxTp: 500, flows: 100, maxFlows: 100000, status: "ok" },
            { host: "host-edge540-50", model: "Edge 540", version: "4.0.0", throughput: 300, maxTp: 1000, flows: 4000, maxFlows: 150000, status: "ok" },
            { host: "host-edge840-07", model: "Edge 840", version: "4.2.2", throughput: 154, maxTp: 710, flows: 2000, maxFlows: 100000, status: "ok" },
            { host: "host-edge2000-80", model: "Edge 2000", version: "5.2.0", throughput: 1500, maxTp: 5000, flows: 80000, maxFlows: 1000000, status: "ok" },
            { host: "host-edge510-90", model: "Edge 510", version: "3.3.0", throughput: 80, maxTp: 100, flows: 1200, maxFlows: 20000, status: "critical" },
            { host: "host-edge620-95", model: "Edge 620", version: "6.1.0", throughput: 120, maxTp: 600, flows: 1000, maxFlows: 120000, status: "ok" },
        ];

        // Fill data to make it look like a larger fleet
        for (let i = 0; i < 10; i++) {
            fleetData.push({
                host: `host-edge610-${100 + i}`,
                model: "Edge 610",
                version: "5.0.0",
                throughput: Math.floor(Math.random() * 200),
                maxTp: 500,
                flows: 500,
                maxFlows: 100000,
                status: "ok"
            });
        }

        // Lifecycle Rules (Derived from "SD-WAN edges lifecycle")
        // Mapping models to EOL status. 
        // 5x0 and 8x0 are generally older. 6x0 are newer.
        const lifecycleRules = {
            "Edge 510": { eol: "2024-12-31", status: "EOL", replacement: "Edge 610" },
            "Edge 520": { eol: "2025-06-30", status: "Warning", replacement: "Edge 620" },
            "Edge 540": { eol: "2025-06-30", status: "Warning", replacement: "Edge 640" },
            "Edge 840": { eol: "2025-12-31", status: "Warning", replacement: "Edge 640" }, // 840 often replaced by 640/680
            "Edge 610": { eol: "2028-12-31", status: "Active", replacement: null },
            "Edge 620": { eol: "2028-12-31", status: "Active", replacement: null },
            "Edge 640": { eol: "2028-12-31", status: "Active", replacement: null },
            "Edge 680": { eol: "2028-12-31", status: "Active", replacement: null },
            "Edge 2000": { eol: "2027-12-31", status: "Active", replacement: null }
        };

        const versionPathLogic = {
            "3.x": ["4.0.0", "4.5.0", "5.0.0", "5.4.0", "6.0.0", "6.4.0"],
            "4.x": ["4.5.0", "5.0.0", "5.4.0", "6.0.0", "6.4.0"],
            "5.0.x": ["5.4.0", "6.0.0", "6.4.0"],
            "5.2.x": ["5.4.0", "6.1.0", "6.4.0"],
            "5.4.x": ["6.1.0", "6.4.0"],
            "6.0.x": ["6.4.0"],
            "6.1.x": ["6.4.0"]
        };

        // --- UI INTERACTION ---

        function switchView(viewId) {
            // Hide all views
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            // Show selected view
            document.getElementById(`view-${viewId}`).classList.remove('hidden');

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${viewId}`)?.classList.add('active');

            // Trigger charts update if needed
            if (viewId === 'dashboard') renderDashboardCharts();
            if (viewId === 'lifecycle') renderLifecycleChart();
        }

        function toggleMobileMenu() {
            const aside = document.querySelector('aside');
            aside.classList.toggle('hidden');
            aside.classList.toggle('fixed');
            aside.classList.toggle('inset-0');
            aside.classList.toggle('bg-white');
            aside.classList.toggle('z-50');
        }

        // --- RENDER LOGIC ---

        function init() {
            renderKPIs();
            renderDashboardCharts();
            renderInventoryTable();
            populateFilters();
            renderLifecycleList();

            // Event Listeners for Filters
            document.getElementById('search-inventory').addEventListener('input', renderInventoryTable);
            document.getElementById('filter-model').addEventListener('change', renderInventoryTable);
            document.getElementById('filter-status').addEventListener('change', renderInventoryTable);
        }

        function renderKPIs() {
            document.getElementById('kpi-total').innerText = fleetData.length;

            const eolCount = fleetData.filter(d => {
                const rule = lifecycleRules[d.model];
                return rule && (rule.status === 'EOL' || rule.status === 'Warning');
            }).length;
            document.getElementById('kpi-eol').innerText = eolCount;

            const versions = fleetData.map(d => parseFloat(d.version));
            const avg = (versions.reduce((a, b) => a + b, 0) / versions.length).toFixed(1);
            document.getElementById('kpi-avg-ver').innerText = avg + ".x";

            const criticalCount = fleetData.filter(d => d.throughput > (d.maxTp * 0.9)).length;
            document.getElementById('kpi-overload').innerText = criticalCount;
        }

        function populateFilters() {
            const models = [...new Set(fleetData.map(d => d.model))].sort();
            const select = document.getElementById('filter-model');
            models.forEach(m => {
                const opt = document.createElement('option');
                opt.value = m;
                opt.innerText = m;
                select.appendChild(opt);
            });
        }

        function renderInventoryTable() {
            const search = document.getElementById('search-inventory').value.toLowerCase();
            const filterModel = document.getElementById('filter-model').value;
            const filterStatus = document.getElementById('filter-status').value;
            const tbody = document.getElementById('inventory-table-body');
            tbody.innerHTML = '';

            let filtered = fleetData.filter(d => {
                const matchesSearch = d.host.toLowerCase().includes(search) || d.model.toLowerCase().includes(search);
                const matchesModel = filterModel === 'all' || d.model === filterModel;

                let matchesStatus = true;
                if (filterStatus === 'critical') matchesStatus = (d.throughput / d.maxTp) > 0.9;
                if (filterStatus === 'ok') matchesStatus = (d.throughput / d.maxTp) <= 0.9;

                return matchesSearch && matchesModel && matchesStatus;
            });

            document.getElementById('inventory-count').innerText = `Affichage de ${filtered.length} √©quipements`;

            filtered.forEach(d => {
                const usagePct = (d.throughput / d.maxTp) * 100;
                let statusColor = 'bg-green-100 text-green-700';
                let statusText = 'Normal';

                if (usagePct > 90) { statusColor = 'bg-red-100 text-red-700'; statusText = 'Critique'; }
                else if (usagePct > 70) { statusColor = 'bg-amber-100 text-amber-700'; statusText = '√âlev√©'; }

                const row = `
                    <tr class="hover:bg-gray-50 transition-colors border-b border-gray-100">
                        <td class="p-4 font-medium text-gray-800">${d.host}</td>
                        <td class="p-4 text-gray-600">${d.model}</td>
                        <td class="p-4 text-gray-600"><span class="px-2 py-1 bg-gray-100 rounded text-xs font-mono">${d.version}</span></td>
                        <td class="p-4 text-right">
                            <div class="flex flex-col items-end">
                                <span>${d.throughput} / ${d.maxTp}</span>
                                <div class="w-24 h-1.5 bg-gray-200 rounded-full mt-1">
                                    <div class="h-1.5 rounded-full ${usagePct > 90 ? 'bg-red-500' : 'bg-blue-500'}" style="width: ${Math.min(usagePct, 100)}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="p-4 text-right text-gray-600">${d.flows.toLocaleString()}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColor}">${statusText}</span>
                        </td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        // --- CHARTS (Chart.js) ---

        let chartModelsInst = null;
        let chartVersionsInst = null;
        let chartLifecycleInst = null;

        function renderDashboardCharts() {
            // Models Chart
            const models = {};
            fleetData.forEach(d => models[d.model] = (models[d.model] || 0) + 1);

            const ctxM = document.getElementById('chart-models').getContext('2d');
            if (chartModelsInst) chartModelsInst.destroy();

            chartModelsInst = new Chart(ctxM, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(models),
                    datasets: [{
                        data: Object.values(models),
                        backgroundColor: ['#f97316', '#3b82f6', '#10b981', '#6366f1', '#f43f5e', '#8b5cf6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });

            // Versions Chart
            const versions = {};
            fleetData.forEach(d => versions[d.version] = (versions[d.version] || 0) + 1);

            const ctxV = document.getElementById('chart-versions').getContext('2d');
            if (chartVersionsInst) chartVersionsInst.destroy();

            chartVersionsInst = new Chart(ctxV, {
                type: 'bar',
                data: {
                    labels: Object.keys(versions).sort(),
                    datasets: [{
                        label: 'Nombre d\'√©quipements',
                        data: Object.keys(versions).sort().map(k => versions[k]),
                        backgroundColor: '#3b82f6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function renderLifecycleChart() {
            const ctxL = document.getElementById('chart-lifecycle').getContext('2d');
            if (chartLifecycleInst) chartLifecycleInst.destroy();

            // Prepare Data: Bars representing time until EOL
            // Current Date: 2026-02-03 (from context)
            const now = new Date("2026-02-03");
            const labels = [];
            const dataDays = [];
            const backgroundColors = [];

            Object.entries(lifecycleRules).forEach(([model, info]) => {
                labels.push(model);
                const eolDate = new Date(info.eol);
                const diffTime = eolDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                dataDays.push(diffDays);
                backgroundColors.push(diffDays < 0 ? '#ef4444' : (diffDays < 365 ? '#f59e0b' : '#10b981'));
            });

            chartLifecycleInst = new Chart(ctxL, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Jours restants avant Fin de Support',
                        data: dataDays,
                        backgroundColor: backgroundColors,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const val = context.raw;
                                    if (val < 0) return "Support Termin√©";
                                    return val + " jours restants";
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderLifecycleList() {
            const container = document.getElementById('lifecycle-list');
            container.innerHTML = '';

            Object.entries(lifecycleRules).forEach(([model, info]) => {
                if (info.status !== 'Active') {
                    const html = `
                        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-100">
                            <div>
                                <div class="font-bold text-gray-800">${model}</div>
                                <div class="text-xs text-red-600">EOL: ${info.eol}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">Remplacement sugg√©r√©</div>
                                <div class="font-medium text-gray-700">${info.replacement}</div>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                }
            });
        }

        // --- SCENARIO LOGIC (The "AI" part) ---

        function runScenario() {
            const targetVersion = document.getElementById('target-version-select').value;
            const strategy = document.getElementById('replacement-strategy').value;
            const resultsDiv = document.getElementById('scenario-results');

            // Show results
            resultsDiv.classList.remove('hidden');

            let compatibleCount = 0;
            let replaceCount = 0;
            let totalCost = 0;
            let actions = [];

            fleetData.forEach(d => {
                const rule = lifecycleRules[d.model];
                const currentMajor = d.version.split('.')[0];
                const targetMajor = targetVersion.split('.')[0];

                let action = "Mise √† jour logicielle";
                let targetHardware = d.model;
                let cost = 0; // Abstract unit
                let isBlocker = false;

                // 1. Hardware Check (Lifecycle)
                if (rule && rule.status === 'EOL') {
                    action = "Remplacement Mat√©riel (EOL)";
                    targetHardware = rule.replacement;
                    cost = 2500; // Base cost for replacement
                    isBlocker = true;
                }
                // 2. Hardware Check (Capacity) - If strategy is 'performance'
                else if (strategy === 'performance' && (d.throughput / d.maxTp > 0.7)) {
                    action = "Upgrade Performance";
                    targetHardware = rule.replacement || "Edge Sup√©rieur";
                    cost = 3000;
                    isBlocker = true;
                }
                // 3. Software Compatibility (Simplified: Older models can't run 6.x)
                else if ((d.model === 'Edge 510' || d.model === 'Edge 520') && parseFloat(targetVersion) >= 6.0) {
                    action = "Remplacement (Incompatible 6.x)";
                    targetHardware = "Edge 610/620";
                    cost = 2000;
                    isBlocker = true;
                }

                if (isBlocker) {
                    replaceCount++;
                    totalCost += cost;
                } else {
                    compatibleCount++;
                    // Minor cost for labor
                    totalCost += 50;
                }

                actions.push({
                    host: d.host,
                    model: d.model,
                    version: d.version,
                    action: action,
                    target: isBlocker ? targetHardware : targetVersion,
                    isBlocker: isBlocker
                });
            });

            // Update Stats
            document.getElementById('res-compatible').innerText = compatibleCount;
            document.getElementById('res-replace').innerText = replaceCount;
            document.getElementById('res-cost').innerText = (totalCost / 1000).toFixed(1) + " k‚Ç¨";

            // AI Insight Text
            const aiText = `
                Pour atteindre la version cible <strong>${targetVersion}</strong>, l'analyse d√©tecte que 
                <strong>${replaceCount}</strong> √©quipements n√©cessitent un remplacement physique (co√ªt est. ${(totalCost / 1000).toFixed(1)}k‚Ç¨).
                ${strategy === 'performance' ? "La strat√©gie 'Performance' a identifi√© des goulots d'√©tranglement proactifs." : "La strat√©gie 'Conservateur' maximise la dur√©e de vie du mat√©riel existant."}
                Le chemin critique concerne principalement les mod√®les <strong>Edge 5xx/8xx</strong> qui ne supportent pas pleinement les fonctionnalit√©s 6.x.
            `;
            document.getElementById('ai-insight-text').innerHTML = aiText;

            // Render Table
            const tbody = document.getElementById('scenario-table-body');
            tbody.innerHTML = '';
            actions.sort((a, b) => b.isBlocker - a.isBlocker).forEach(a => {
                const row = `
                    <tr class="border-b border-gray-100 ${a.isBlocker ? 'bg-red-50' : ''}">
                        <td class="p-3 font-medium">${a.host}</td>
                        <td class="p-3 text-gray-500">${a.model}</td>
                        <td class="p-3 text-gray-500">${a.version}</td>
                        <td class="p-3 ${a.isBlocker ? 'text-red-600 font-bold' : 'text-green-600'}">${a.action}</td>
                        <td class="p-3">${a.target}</td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });

            // Render Path Steps
            renderPathSteps(targetVersion);
        }

        function renderPathSteps(target) {
            const container = document.getElementById('upgrade-steps');
            container.innerHTML = '';

            // Simplified logic: Start -> Intermediate -> Target
            const steps = [
                { title: "Audit", desc: "V√©rification EOL/EOS", icon: "üìã" },
                { title: "Pr√©-requis", desc: "Upgrade vers 5.4.0 (Pivot)", icon: "üîÑ" },
                { title: "Remplacements", desc: "Hardware Legacy", icon: "üì¶" },
                { title: "D√©ploiement", desc: `Version ${target}`, icon: "üöÄ" }
            ];

            steps.forEach((s, idx) => {
                const html = `
                    <div class="step-item relative flex-1 flex flex-col items-center text-center z-10">
                        <div class="step-connector w-full absolute top-1/2 left-1/2 -z-10 h-0.5 bg-gray-200 hidden md:block" style="${idx === steps.length - 1 ? 'display:none' : ''}"></div>
                        <div class="w-12 h-12 bg-white border-2 border-orange-500 rounded-full flex items-center justify-center text-xl shadow-sm mb-3">
                            ${s.icon}
                        </div>
                        <h4 class="font-bold text-gray-800 text-sm">${s.title}</h4>
                        <p class="text-xs text-gray-500 mt-1">${s.desc}</p>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // Init App
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>

</html>